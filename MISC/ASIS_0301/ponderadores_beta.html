<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Propuesta de ponderadores longitudinales</title>
    <meta charset="utf-8" />
    <meta name="author" content="Equipo de asistentes ELSOC" />
    <script src="ponderadores_beta_files/header-attrs-2.20/header-attrs.js"></script>
    <script src="ponderadores_beta_files/htmlwidgets-1.6.1/htmlwidgets.js"></script>
    <link href="ponderadores_beta_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="ponderadores_beta_files/datatables-binding-0.27/datatables.js"></script>
    <script src="ponderadores_beta_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="ponderadores_beta_files/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="ponderadores_beta_files/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="ponderadores_beta_files/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="ponderadores_beta_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="ponderadores_beta_files/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


class: middle,center


&lt;style type="text/css"&gt;
.tabla {
  font-size: 13px;
}
&lt;/style&gt;


&lt;h1&gt; .morado[Ponderadores longitudinales] &lt;/h1&gt;

&lt;img src="../../IMG/ELSOC.jpeg" width="px"/&gt;

**.large[ Version BETA | COES | Enero 2023]**
---
&lt;h1&gt; .morado[Estructura presentación] &lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;¿Qué es un ponderador longitudinal?&lt;/li&gt;
      &lt;ul&gt;
      &lt;li&gt;Características heredadas de los pesos transversales&lt;/li&gt;
    &lt;/ul&gt;
  &lt;li&gt;Modelamiento No Respuesta
    &lt;ul&gt;
      &lt;li&gt;Ventajas y desventajas modelos glm vía GEE&lt;/li&gt;
      &lt;li&gt;Modelo ajustado para m1 y m2&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Recorte a los pesos&lt;/li&gt;
  &lt;li&gt;Calibración&lt;/li&gt;    
  &lt;ul&gt;
      &lt;li&gt;Proyecciones de población INE&lt;/li&gt;
      &lt;li&gt;Raking&lt;/li&gt;
  &lt;/ul&gt;
  &lt;li&gt;Limitaciones pesos longitudinales&lt;/li&gt;  
&lt;/ul&gt;

---
class: inverse,middle,center
&lt;h1&gt; Resumen Ejecutivo &lt;/h1&gt;

---
&lt;h1&gt; .morado[Resumen ejecutivo] &lt;/h1&gt;

Los ponderadores longitudinales toman los pesos originales y aplican una serie de transformaciones: 

1.    Ajuste en base a la probabilidad de participación de un individuo en un año en particular a partir de la segunda ola de cada muestra. 

2.    Recorte de los valores extremos considerando el  90% central de la distribución empírica de los pesos. 

3.    Ajustes a totales poblacionales: Proyecciones poblacionales de sexo y tramos etarios.

Se construyen dos ponderadores:  a) Total de observaciones. b) Uso con paneles balanceados.
---

&lt;h1&gt; .morado[Resumen ejecutivo] &lt;/h1&gt;

Modelamiento de NR: a) Glm vía GEE. b) Se hace un modelo distinto para cada cada muestra. c) Selección backward sobre variables de diseño muestral, geográficas, del cuestionario y del proceso de recolección de datos.  

Ajuste a totales poblacionales: a) Raking, b) Ajuste a totales marginales de sexo y tramos de edad, c) Limitación a la población urbana mayor de 18 años. 

Se aplica también un re-escalamiento para dejar los pesos a niveles muestrales. 

Las limitaciones más importantes de los pesos tienen que ver con no considerar la elegibilidad de la persona a la hora de hacer un ajuste de no respuesta. 

---
&lt;h1&gt; .morado[¿Qué son los ponderadores longitudinales?] &lt;/h1&gt;

Son transformaciones de los pesos originales de ELSOC.

&lt;ul&gt;
  &lt;li&gt;Pesos &lt;b&gt;.morado[transversales:]&lt;/b&gt;&lt;/li&gt;
      &lt;ul&gt;
      &lt;li&gt; Inverso P. Selección &lt;/li&gt;
      &lt;li&gt; Ajuste de NR (2016 y 2018) &lt;/li&gt;
      &lt;li&gt;PS Región y Sexo&lt;/li&gt;
      &lt;li&gt;Re-escalamientos&lt;/li&gt;
    &lt;/ul&gt;
  &lt;li&gt;Pesos  &lt;b&gt;.morado[longitudinales:]&lt;/b&gt;&lt;/li&gt;
      &lt;ul&gt;
      &lt;li&gt;Inverso P. Selección&lt;/li&gt;
      &lt;li&gt;Ajuste de NR (2016 y 2018)&lt;/li&gt;
      &lt;li&gt;Ajuste NR (2017 hasta 2022)&lt;/li&gt;
      &lt;li&gt;Recorte a los pesos&lt;/li&gt;
      &lt;li&gt;Calibración Edad y Sexo&lt;/li&gt;
      &lt;li&gt;Re-escalamientos&lt;/li&gt;

---
&lt;h1&gt; .morado[Características heredadas de los pesos transversales] &lt;/h1&gt;

Los pesos longitudinales mantienen el cálculo del inverso de la probabilidad de selección. Al mismo tiempo se mantiene el ajuste de no respuesta de la primera ola de cada muestra.

Inverso de probabilidad de selección:

Ajuste de no respuesta de la primera ola:

---
class: inverse,middle,center
&lt;h1&gt; Ajuste por Atrición &lt;/h1&gt;

---
&lt;h1&gt; .morado[Modelamiento de la no respuesta] &lt;/h1&gt;

Consideramos como atrición el proceso por el cual un individuo que respondió en la primera ola de cada muestra no participa del estudio en alguna o todas las olas posteriores. 

La existencia de patrones sistemáticos en la no participación de los entrevistados puede introducir sesgo en las estimaciones. 

El ajuste por atrición consiste utilizar las probabilidades predichas por un modelo para darle más importancia a las observaciones que comparten características con los participantes que dejan participar del estudio. 

La probabilidad que una persona responda en un año particular es modelada separadamente para la muestra original y la muestra de refresco.

Se asume que la muestra original y la muestra de refresco tienen procesos de atrición distintos. Esto además evita imputar valores para la muestra de refresco en los años 2016 y 2017
---
&lt;h1&gt; .morado[Técnica de modelamiento de la no respuesta] &lt;/h1&gt;

Glm vía GEE: Permiten trabajar con observaciones correlacionadas.

Ventajas: 1) Permiten dar estructura autorregresiva a las observaciones dentro de un mismo individuo. 2) Son rápidos de calcular y usualmente no presentan problemas de convergencia como los glmm.

Desventajas: Estos modelos se limitan a un único nivel de anidamiento. Es decir, sólo  podemos considerar la correlación entre observaciones de un mismo individuo en distintos puntos del tiempo, pero no entre individuos dentro de un mismo barrio, o entre individuos dentro de una misma ciudad. 

Para escoger el mejor subconjunto de covariables se utilizó un método de selección backward, y como criterio de ajuste, se utilizó un análogo del AIC para los GEE (QICu).
---
&lt;h1&gt; .morado[Covariables del modelo] &lt;/h1&gt;

Tres fuentes de información: 

&lt;ul&gt;
  &lt;li&gt;Cuestionario:&lt;/li&gt;
      &lt;ul&gt;
      &lt;li&gt;Estrato diseño muestral, Nivel Educacional, Sexo, Tramo etario y Estado Civil.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;li&gt;Información territorial:
    &lt;ul&gt;
      &lt;li&gt;Densidad poblacional, Escolaridad promedio jefes de hogar, Proporción de viviendas en condición de hacinamiento, Proporción de viviendas en situación precaria, Tamaño de hogar promedio y Cantidad promedio de personas por hogar.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Proceso de recolección de datos:&lt;/li&gt;
      &lt;ul&gt;
      &lt;li&gt;Número de items con nsnr promedio por módulo, Número de visitas en el año anterior.&lt;/li&gt;
    &lt;/ul&gt;
&lt;/ul&gt;

---
class: tabla
&lt;h1&gt; .morado[Modelo ajustado muestra original] &lt;/h1&gt;











<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3c70c43f44c0c95480e5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3c70c43f44c0c95480e5">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],["Intercepto","Densidad poblacional zc","30 a 44 años","45 a 59 años","60 o más","Educ. Media","Educ. Técnica","Educ. Universitaria","C. Medianas","C. Pequeñas","G. Concepción","G. Santiago","G. Valparaiso","Escolaridad jh zc","NSNR 1ra ola","2018","2019","2021","2022","P. Viviendas precarias zc","Mujer","Tamaño hogar prom. zc","Visitas ola anterior"],[1.3446,-0,0.1143,0.5416,0.3914,0.1582,0.065,0.161,-0.5243,-0.0822,-0.0383,-0.3336,-0.3235,-0.1094,-0.7457,-0.5582,-0.6926,-1.3363,-1.3351,-0.0106,0.3854,-0.0606,-0.0476],[0.1339,0,0.0985,0.1001,0.1083,0.0609,0.0803,0.0921,0.1181,0.1323,0.1304,0.1157,0.1268,0.0253,0.1775,0.0494,0.0498,0.0533,0.0532,0.0039,0.067,0.099,0.0067],["***","*","","***","***","***","","*","***","","","***","**","***","***","***","***","***","***","***","***","","***"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Variable<\/th>\n      <th>Coeficiente<\/th>\n      <th>Err. Estándar<\/th>\n      <th>Significancia<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>


---
class: tabla
&lt;h1&gt; .morado[Modelo ajustado muestra de refresco] &lt;/h1&gt;

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5c6989cc39ae8c546867" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5c6989cc39ae8c546867">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13"],["Intercepto","Soltero","30 a 44 años","45 a 59 años","60 o más","Escolaridad jh zc","NSNR 1ra ola","2021","2022","P. Viviendas precarias zc","Mujer","Tamaño hogar prom. zc","Visitas ola anterior"],[1.3681,-0.1161,0.0111,0.3367,0.2363,-0.0549,-0.8585,-0.9456,-0.9323,0.0055,0.326,0.2607,-0.0483],[0.1269,0.0803,0.1267,0.1284,0.1433,0.0288,0.2326,0.0712,0.0738,0.0051,0.0917,0.1491,0.0119],["***","","","***","*","*","***","***","***","","***","*","***"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Variable<\/th>\n      <th>Coeficiente<\/th>\n      <th>Err. Estándar<\/th>\n      <th>Significancia<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>



---
&lt;h1&gt; .morado[Recorte de los pesos] &lt;/h1&gt;

Un problema de los pesos originales es que poseen valores extremos importantes, especialmente luego del ajuste de no respuesta, dichos valores se dan en ambas colas de la distribución. 

Se toma la decisión de recortar el 10% más extremo de la distribución de los pesos.

Es decir, los valores que sean inferiores al percentil 5 o que sean mayores al 95 son reemplazados por el valor de dichos percentiles respectivamente. De esta manera se evita tener pesos con observaciones perdidas. 

---

&lt;h1&gt; .morado[Calibración] &lt;/h1&gt;

Es una de las formas de hacer coincidir las estimaciones muestrales con valores totales conocidos para la población objetivo. 


Los pesos transversales se post-estratifican según totales cruzados por región y por sexo. Los pesos longitudinales se calibran respecto a los totales poblacionales marginales para las variables de sexo y tramo etario.

Estos totales corresponden a las proyecciones hechas por el INE para la población mayor de 18 años de zonas urbanas.

---
&lt;h1&gt; .morado[Raking] &lt;/h1&gt;

Puede pensarse como una post-estratificación iterativa sobre cada una de las variables auxiliares de interés. 

Como ventaja respecto a la post-estratificación es que no se requiere de valores para todos las combinaciones posibles de categorías de las variables auxiliares, y también se evitan valores extremos debido a combinaciones con pocas observaciones. 

El ponderador longitudinal total calibra las proporciones muestrales de todas las observaciones del estudio a los totales poblacionales conocidos. El ponderador longitudinal panel hace lo mismo pero para el subconjunto de observaciones que responden a todas olas. 

Se ocupa la funcion `rake()` de la librería `survey` para cada año.

---
&lt;h1&gt; .morado[Re-escalamientos] &lt;/h1&gt;

Re-escalar los pesos hace que la suma de los ponderadores sea equivalente al tamaño muestral. 

Esto permite darle una interpretación al valor del peso de una observación.

Se hace un re-escalamiento para cada año, y cada peso longitudinal reproduce tamaños muestrales distintos. 

`ponderadorlg_total` reproduce por año el tamaño muestral de todas las observaciones de ELSOC, mientras que  `ponderadorlg_panel` reproduce el tamaño muestral del panel balanceado, para cada muestra.

---
class: inverse,middle,center
&lt;h1&gt; Demostración de los pesos &lt;/h1&gt;
---

&lt;h1&gt; .morado[Totales poblacionales] &lt;/h1&gt;

&lt;iframe src='graficos/gf_ine_proy_sexo.html' width="100%" height="400" id="igraph" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;
---
&lt;h1&gt; .morado[Totales poblacionales] &lt;/h1&gt;

&lt;iframe src='graficos/gf_ine_proy_tramo.html' width="100%" height="400" id="igraph" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;
---
&lt;h1&gt; .morado[Proporciones muestrales] &lt;/h1&gt;

&lt;iframe src='graficos/gf_tramo_etario_muestral_ponderado.html' width="100%" height="400" id="igraph" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;


---
&lt;h1&gt; .morado[Proporciones muestrales] &lt;/h1&gt;

&lt;iframe src='graficos/gf_sexo_muestral_ponderado.html' width="100%" height="400" id="igraph" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;

---
&lt;h1&gt; .morado[Aplicación ponderadores] &lt;/h1&gt;

&lt;iframe src='graficos/satis_demo_ponderadores.html' width="100%" height="400" id="igraph" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;

---
&lt;h1&gt; .morado[Limitaciones] &lt;/h1&gt;

Los ponderadores transversales y los longitudinales no consideran la elegilibilidad de los entrevistados a la hora de hacer un ajuste de no respuesta. 

Dado que la calibración y los re-escalamientos dependen de la sub-muestra particular con la que se trabaje, usuarios que ocupen otras combinaciones de olas, podrían tener sesgo en sus observaciones.


---
&lt;h1&gt; .azul[Posibles ajustes futuros] &lt;/h1&gt;

Las funciones del paquete `survey` permiten poner cotas superiores e inferiores a los ajustes que se hace en la etapa de calibración.

Podría considerarse agregar la variable nivel educacional a la calibración, la cuál tiene únicamente un total para el año 2017.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
